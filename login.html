<!DOCTYPE html>

<html>
    <head>
        <title>Cool Login Page</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>
            $.ajax({
                url: 'http://localhost:8080/sessionstatus',
                method:'POST',
                data: {}
                }).done(function(data){if(data['loginStatus'] == true) window.location.href="/home";})
        </script>
    </head>
    <body>
        <h1>Login</h1>
        <div class="login-form">

            <label for="username">Username: </label>
            <input id="username" name="username" type="text" placeholder="Enter Username" required>

            <label for="password">Password: </label>
            <input id="password" name="password" type="password" placeholder="Enter Password" required>

            <button class="trigger" type="submit">Login</button>

            <p class="badLoginWarning"></p>

            <script name="login-check">
                function changeDom(){
                    $.ajax({
                        url: 'http://localhost:8080/authenticate',
                        method:'POST',
                        data: {
                            "username" : document.getElementById("username").value, 
                            "password" : document.getElementById("password").value
                        }
                        }).done(function(data){
                            if(data['loginStatus'] == true) {
                                window.location.href="/home";
                            } 
                            else {
                                if(data['lockedOut']) {
                                    $('p.badLoginWarning').replaceWith(
                                        '<p class="badLoginWarning">You have been locked out.</p>'
                                     );
                                } else if(data['incorrectAttempts'] == 2) {
                                    $('p.badLoginWarning').replaceWith(
                                        '<p class="badLoginWarning">The username or password you entered is incorrect. You have 1 attempt remaining.</p>'
                                     );
                                } else {
                                    $('p.badLoginWarning').replaceWith(
                                        '<p class="badLoginWarning">The username or password you entered is incorrect.</p>'
                                     );
                                }
                            } 
                        }).fail(function(){
                            console.log('BAD POST REQUEST!');
                        });
                    };
                $('.trigger').click(function(){
                    changeDom();
                });
           </script>

        </div>
    </body>
</html>